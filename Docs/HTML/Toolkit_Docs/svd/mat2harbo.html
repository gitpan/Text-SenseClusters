<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>mat2harbo.pl</title>
<link rev="made" href="mailto:jluttine@marimba.d.umn.edu" />
</head>

<body style="background-color: white">

<p><a name="__index__"></a></p>
<!-- INDEX BEGIN -->

<ul>

	<li><a href="#name">NAME</a></li>
	<li><a href="#synopsis">SYNOPSIS</a></li>
	<li><a href="#usgae">USGAE</a></li>
	<li><a href="#input">INPUT</a></li>
	<ul>

		<li><a href="#required_arguments_">Required Arguments:</a></li>
		<ul>

			<li><a href="#matrix">MATRIX</a></li>
		</ul>

		<li><a href="#optional_arguments_">Optional Arguments:</a></li>
		<ul>

			<ul>

				<li><a href="#title_title">-title TITLE</a></li>
				<li><a href="#id_id">-id ID</a></li>
				<li><a href="#cpform_cpform">-cpform CPFORM</a></li>
				<li><a href="#rpform_rpform">-rpform RPFORM</a></li>
				<li><a href="#numform_numform">-numform NUMFORM</a></li>
			</ul>

			<li><a href="#parameter_setting_options__">Parameter Setting Options :</a></li>
			<ul>

				<li><a href="#param">-param</a></li>
				<li><a href="#k_k">-k K</a></li>
				<li><a href="#rf_rf">-rf RF</a></li>
				<li><a href="#iter_i">-iter I</a></li>
			</ul>

			<li><a href="#help_on_setting_parameters_in_file_las2_h">Help on setting parameters in file las2.h</a></li>
			<li><a href="#other_options__">Other Options :</a></li>
			<ul>

				<li><a href="#help">-help</a></li>
				<li><a href="#version">-version</a></li>
			</ul>

		</ul>

	</ul>

	<li><a href="#harwell_boeing_format">Harwell Boeing Format</a></li>
	<ul>

		<li><a href="#header_section">Header Section</a></li>
		<li><a href="#data_section">Data Section</a></li>
		<ul>

			<li><a href="#block1_pointers">BLOCK1 POINTERS</a></li>
			<li><a href="#block2_row_indices">BLOCK2 ROW_INDICES</a></li>
			<li><a href="#block3_values">BLOCK3 VALUES</a></li>
		</ul>

		<li><a href="#sample_output">Sample Output</a></li>
	</ul>

	<li><a href="#author">AUTHOR</a></li>
	<li><a href="#copyright">COPYRIGHT</a></li>
</ul>
<!-- INDEX END -->

<hr />
<p>
</p>
<h1><a name="name">NAME</a></h1>
<p>mat2harbo.pl</p>
<p>
</p>
<hr />
<h1><a name="synopsis">SYNOPSIS</a></h1>
<p>Converts a given sparse matrix in SenseClusters' format to Harwell-Boeing(HB) 
sparse format.</p>
<p>
</p>
<hr />
<h1><a name="usgae">USGAE</a></h1>
<p>mat2harbo.pl [OPTIONS] MATRIX</p>
<p>
</p>
<hr />
<h1><a name="input">INPUT</a></h1>
<p>
</p>
<h2><a name="required_arguments_">Required Arguments:</a></h2>
<p>
</p>
<h3><a name="matrix">MATRIX</a></h3>
<p>A sparse MATRIX in SenseClusters' format that is to be converted into 
Harwell Boeing format.</p>
<p>First line should show exactly 3 numbers separated by blanks as 
 #nrows #ncols #nnz</p>
<p>where</p>
<pre>
 #nrows = Number of rows 
 #ncols = Number of columns 
 #nnz = Total number of non-zero values</pre>
<p>in the MATRIX.</p>
<p>Each line thereafter should show a row of the MATRIX in sparse format.
A sparse row should be a space separated list of pairs of numbers 
where the first number shows the column index of a non-zero value 
and second number is the non-zero value itself that appears at that column 
index.</p>
<p>Column index counting starts from 1.</p>
<p>Sample MATRIX examples =&gt;</p>
<ol>
<li></li>
<pre>
 5 5 15
 2 9 4 9
 1 6 2 5 3 7 4 8 5 6
 1 4 2 5
 1 7 2 6 3 7
 1 9 2 8 3 9</pre>
<p>Shows a 5 x 5 integer matrix containing total 15 non-zero elements.
Each ith line after the first line shows the non-zero elements in the ith
row. e.g. 2nd line (1st row) has 2 non-zero values (both 9) at column indices 
2 and 4. 6th line (5th row) has 3 non-zero values; 9 at index 1, 8 at index 2
and 9 at index 3.</p>
<li></li>
<pre>
 7 8 34
 1 0.160 2 -0.059 3 1.864 5 0.724 6 -0.472 7 -0.467
 2 -0.209 4 1.487 5 6.728 7 -3.085 8 1.396
 1 14.594 3 -2.858 4 -0.618 6 16.510 8 -2.314
 3 -0.384 5 -1.189 7 -0.155 8 0.006
 1 -0.128 3 0.020 4 -0.125 8 0.039
 2 0.062 3 0.058 4 0.016 5 0.057 7 0.407 8 0.015
 4 0.033 6 1.377 7 0.074 8 0.994</pre>
<p>Shows a 7 x 8 real matrix =&gt;</p>
<pre>
   7 8
   0.160 -0.059  1.864  0.000  0.724 -0.472 -0.467  0.000
   0.000 -0.209  0.000  1.487  6.728  0.000 -3.085  1.396
  14.594  0.000 -2.858 -0.618  0.000 16.510  0.000 -2.314
   0.000  0.000 -0.384  0.000 -1.189  0.000 -0.155  0.006
  -0.128  0.000  0.020 -0.125  0.000  0.000  0.000  0.039
   0.000  0.062  0.058  0.016  0.057  0.000  0.407  0.015
   0.000  0.000  0.000  0.033  0.000  1.377  0.074  0.994</pre>
</ol>
<p>
</p>
<h2><a name="optional_arguments_">Optional Arguments:</a></h2>
<p>
</p>
<h4><a name="title_title">--title TITLE</a></h4>
<p>Allows user to specify the Title of the MATRIX which is displayed at Line1
(1-72) of the output HB matrix.
If --title is not specified, mat2harbo uses the MATRIX file name as 
the default title.</p>
<p>
</p>
<h4><a name="id_id">--id ID</a></h4>
<p>Programs processing the HB formatted matrix can identify the matrix by the ID 
specified at Line1 (73-80). Default ID is ``harbomat''.</p>
<p>
</p>
<h4><a name="cpform_cpform">--cpform CPFORM</a></h4>
<p>Specifies the Column Pointer Format. The column pointer should have the format
of type MiN which indicates that each line in Block1 contains M integer
pointers each occupying N character spaces. Default format is 10i8.</p>
<p>Note: M x N must be 80.</p>
<p>
</p>
<h4><a name="rpform_rpform">--rpform RPFORM</a></h4>
<p>Specifies the Row Pointer Format for row pointers in Block2. This has same 
MiN type of format as --cpform.</p>
<p>
</p>
<h4><a name="numform_numform">--numform NUMFORM</a></h4>
<p>Specifies the Numeric Format to represent the matrix values in Block3.</p>
<p>mat2harbo allows 2 numeric formats :</p>
<p>1. MiN type, which has same interpretation as --cpform and --rpform.</p>
<p>2. MfD.F - which means that there are total M real numbers on each line 
of block3, each occupying total D digit/character space, of which last F 
digits show fractional portion.</p>
<p>Thus, Matrix values could be Integer or Real, selected by specifying a 
particular format.</p>
<p>Default NUMFORM is (5f16.10) which uses 16 digits for each MATRIX value of which
last 10 digits stand for the fractional part and each line contains 5 such 
real numbers.</p>
<p>
</p>
<h3><a name="parameter_setting_options__">Parameter Setting Options :</a></h3>
<p>The options listed in this section create the parameter file (lap2) for las2.c
automatically.</p>
<p>
</p>
<h4><a name="param">--param</a></h4>
<p>Creates the parameter file lap2 that can be directly used while running las2.</p>
<p>
</p>
<h4><a name="k_k">--k K</a></h4>
<p>Sets the value of maxprs option in LAP2 file to K i.e. 
requests K singular triplets from las2. Value of K should not exceed the 
number of columns of MATRIX.
Default K = 300</p>
<p>
</p>
<h4><a name="rf_rf">--rf RF</a></h4>
<p>Reduces the dimensions of the column space of the MATRIX by scaling factor RF
i.e. if the MATRIX has N columns, maxprs is set to N/RF where RF &gt; = 1</p>
<p>In other words, N/RF singular triplets are requested from las2.
Default RF = 10 that reduces the column space to 10% or preserves 10% of the 
original dimensions.</p>
<p>If both --k and --rf are specified, maxprs = <code>min(K,N/RF)</code>
Thus, default maxprs = <code>min(300,N/10)</code></p>
<p>
</p>
<h4><a name="iter_i">--iter I</a></h4>
<p>Specifies the number of iterations for las2.
I, if specified, should not exceed the number of columns in the MATRIX
and I should be at least as high as maxprs.
Default I = min((3 * maxprs),#cols) where maxprs = min(K,N/RF).</p>
<p>
</p>
<h3><a name="help_on_setting_parameters_in_file_las2_h">Help on setting parameters in file las2.h</a></h3>
<p>The header file las2.h in SVDPACKC specifies values of various constants
for las2. This section provides some guidelines on setting these constants
for using SenseClusters.</p>
<ul>
<li><strong><a name="item_nmax">NMAX</a></strong><br />
</li>
Specifies the maximum possible number of columns in the matrix given to las2.
las2.h initially has a value of NMAX = 3000, which allows a maximum of 
3000 columns. However, we have found this default is too small for many 
of our experiments, so we recommend setting NMAX much higher. We  
routinely use a value of 30,000, and will assume that the user has 
reset NMAX in las2.h to this value in the rest of this discussion.
<p>In general, this value should be higher than NCOLS shown by the 3rd column
on the 3rd line in the output of mat2harbo.pl.</p>
<p></p>
<li><strong><a name="item_nzmax">NZMAX</a></strong><br />
</li>
Specifies the maximum possible number of non-zero values in the matrix.
Initially the settings in las2.h have NZMAX = 100000. However, 
again we have found this to be too small. If the user sets NMAX to 30,000, 
and if we assume a 30,000 x 30,000 matrix is approximately 1%   dense,  
NZMAX could be set to 9,000,000 (30,000 x 30,000 / 100). This is the value 
we routinely use, and we will assume that the user has reset NZMAX to this 
value in the rest of this discussion.
<p>The user can check the exact NZMAX for their matrix on line 3 column 4 of  
the output matrix displayed by mat2harbo.pl and then set NZMAX to  
something higher than that.</p>
<p></p>
<li><strong><a name="item_lmtnw">LMTNW</a></strong><br />
</li>
This specifies the maximum total memory to be allocated by las2. The  
initial setting of LMTNW in las2.h is 600000, however, we find that this 
is often too small. In general, the size of LMTNW is determined by the  
values you set NMAX and NZMAX to. LMTNW should be at least as large as :
<p>LMTNW = (6*NMAX + 4*NMAX + 1 + NZMAX*NZMAX)</p>
<p>mat2harbo.p assumes that NMAX has been reset to 30,000 and that NZMAX is  
set to 9,000,000.  Thus,</p>
<p>LMTNW = ((6 * 30,000) + (4 * 30,000) + 1 + (30,000 * 30,000))</p>
<p>This leads to the new value for LMTNW of 900,300,001, which is equivalent 
to a maximum working memory size of 1 GB. We have found this size to be  
more than adquate to do SVD on a 25,000 x 25,000 matrix.</p>
<p>math2arbo.pl will show an advisory message indicating the minimum size 
that LMNTW should be set for, and will issue a warning message if the  
actual size needed for the user matrix exceeds 900,300,001 (approx 1 GB).</p>
<p>Memory is dynamically allocated by las2 depending upon the size of the input
matrix, irrespective of the value of LMTNW. In short, LMTNW specifies the
upper limit on memory consumption and the actual consumption depends on the
size of the matrix. Hence, LMTNW doesn't specify the total memory that las2
will *always* consume rather its an upper limit that could be consumed if
necessary.</p>
<p></p></ul>
<p>In case if las2 fails due to insufficient values of these parameters 
as indicated by the las2.h file, an error message will be shown in output 
file lao2 suggesting that the matrix is too large or something ... User is
adviced to check 3rd line of the matrix in Harwell-Boeing format (as produced 
by this program) that is given to las2. Check if NCOLS shown at column 3 of 
line 3 in the HB matrix exceeds NMAX. If so, increase NMAX to something higher
than NCOLS. If not, check if NNZ shown by column 4 on line 3 of the HB matrix 
exceeds NZMAX in las2.h, if so, increase NZMAX. If not, increase the LMTNW
to something higher than (6*NMAX + 4*NMAX + 1 + NMAX*NMAX), or simply
increase it without too much computations until las2 succeeds :-)</p>
<p>The other problem that a user might notice is that sometimes las2 runs 
for a very long time like more than few days. In such case, user is advised
to restart las2 by reducing the values of parameters 'maxprs' and 'iter' in 
parameter file lap2. Specifically, the 2nd parameter in lap2 is iter and 
the 3rd one is maxprs. Remember that, iter has to be &gt;= maxprs.</p>
<p>
</p>
<h3><a name="other_options__">Other Options :</a></h3>
<p>
</p>
<h4><a name="help">--help</a></h4>
<p>Displays this message.</p>
<p>
</p>
<h4><a name="version">--version</a></h4>
<p>Displays the version information.</p>
<p>
</p>
<hr />
<h1><a name="harwell_boeing_format">Harwell Boeing Format</a></h1>
<p>
</p>
<h2><a name="header_section">Header Section</a></h2>
<ul>
<li><strong><a name="item_line1">Line1 (Title[72], Id[8])</a></strong><br />
</li>
<li><strong><a name="item_skipped">Line2 Skipped (as SVDPack ignores this line)</a></strong><br />
</li>
<li><strong><a name="item_line3">Line3 (Type[3], 11x, Nrows[14], Ncols[14], NNZ[14], Nrhs[14])</a></strong><br />
</li>
where Type[3] is a 3 Character Field in which
<ol>
<li><strong><a name="item_char_5b1_5d__3d">char[1] =</a></strong><br />
</li>
r for Real matrix,
<p>c for Complex matrix,</p>
<p>p for Pattern matrix</p>
<p></p>
<li><strong><a name="item_char_5b2_5d__3d">char[2] =</a></strong><br />
</li>
u for Unsymmetric matrix,
<p>h for Hermitian matrix (Aij=Aji* where Aji* is a complex conjugate of Aij),</p>
<p>z for Skew Symmetrix matrix</p>
<p>r for Rectangular matrix</p>
<p></p>
<li><strong><a name="item_char_5b3_5d_3d">char[3]=</a></strong><br />
</li>
a for Assembled matrix
<p>f for Unassembled Finite Elements</p>
<p></p></ol>
<p>Nrows = Number of Rows</p>
<p>Ncols = Number of Columns</p>
<p>NNZ = Number of Non-Zero Elements</p>
<p>Nrhs = Number of Right-Hand Sides (not used in SenseClusters)</p>
<li><strong><a name="item_line4">Line4</a></strong><br />
</li>
(Pointer_Format[16], Row_index_Format[16], Numeric_Value_Format[20],
RHS_Format[20])
<p>Pointers and Row Indices could have MiN type of format which specifies
that there are M intergers on each line and each represented with N digits. 
(M x N must be = 80 as this format only supports column width of maximum 80
characters)</p>
<p>Numeric Values can have either MiN format with same interpretation of 
M and N as above or MfD.F format which specifies that there are M real 
numbers on each line, each occupying total D digit space of each last F digits 
show the fractional part.</p>
<p>Note: D is that total space used to represent a number that includes the 
decimal point and +/- sign if any.</p>
<p></p></ul>
<p>The above 4 Lines form the Header of the HB sparse matrix.</p>
<p>
</p>
<h2><a name="data_section">Data Section</a></h2>
<p>This section contains 3 blocks which contain the non-zero values in the matrix
along with their row and column index information.</p>
<pre>
 *************************************************************************
             NON-ZERO ENTRIES ARE STORED IN COLUMN ORDER !!!
 *************************************************************************</pre>
<p>We consider data section of 3 blocks:</p>
<p>
</p>
<h3><a name="block1_pointers">BLOCK1 POINTERS</a></h3>
<p>The first block is an array whose entries show the indices (in block3) of the
leading non-zero value of every column.</p>
<p>e.g. If a given matrix is</p>
<pre>
 4 6
 2 3 0 0 0 1
 0 2 0 1 2 0
 0 0 2 4 1 0 
 1 1 0 0 5 0</pre>
<p>Then the first block will contain the pointers</p>
<p>[1 3 6 7 9 12 13]</p>
<p>This shows that</p>
<p>The first column begins at the 1st non-zero entry (2)
The second column begins at the 3rd non-zero entry (3) [in COLUMN ORDER] 
The third column begins at the 6th non-zero entry (2)
The forth column begins at the 7th non-zero entry (1)
and so on ...</p>
<pre>
 *************************************************************************
        NULL columns (having no non-zero elements) are not allowed. 
 *************************************************************************</pre>
<p>Note: The column pointers start at 1.</p>
<p>The last entry in @pointers contains an extra pointer pointing to one location 
after the last entry. So the last index in @pointers will always be #nnz + 1 
(where #nnz = total no. of non-zero entries)</p>
<p>
</p>
<h3><a name="block2_row_indices">BLOCK2 ROW_INDICES</a></h3>
<p>This block stores the row indices of the non-zero matrix entries in column 
order.</p>
<p>For above matrix, this block will look like</p>
<p>[1 4 1 2 4 3 2 3 2 3 4 1]</p>
<p>which shows that</p>
<p>The 1st non-zero entry is at 1st row.
The 2nd non-zero entry is at 4th row.
The 3rd non-zero entry is at 1st row
and so on ....</p>
<p>Note: Row indices start from 1.</p>
<p>
</p>
<h3><a name="block3_values">BLOCK3 VALUES</a></h3>
<p>This block contains the actual non-zero values from the matrix in 
column order.</p>
<p>Thus, the block3 for the above shown matrix will look like</p>
<p>[2 1 3 2 1 2 1 4 2 1 5 1]</p>
<p>General Observations:</p>
<ol>
<li><strong><a name="item_length">The <code>length(block2)=length(block3)</code> and each is equal to the number 
of non-zero entries in the matrix.</a></strong><br />
</li>
<li><strong>The <code>length(block1)</code> = #columns of matrix + 1 as each column will have
an entry in block1 that shows the position of the leading non-zero element 
in it and there are no NULL columns allowed.</strong><br />
</li>
+1 because there is an extra pointer pointing to the location after the last 
non-zero entry.
<p></p>
<li><strong><a name="item_leading">The column pointers in block1 are also the pointers to block3 entries
where the <code>leading(first)</code> non-zero entry of each column is located.</a></strong><br />
</li>
</ol>
<p>
</p>
<h2><a name="sample_output">Sample Output</a></h2>
<p>matrix.dat                                                 harbomat</p>
<p>#</p>
<pre>
 rra                  4             6            11             0</pre>
<pre>
    (10i8)          (10i8)            (8f10.3)            (8f10.3)</pre>
<pre>
       1       3       5       6       7      10      12
       2       3       2       3       4       1       1       2       
       3       3       4
     1.000     1.000     2.000     4.000     1.000     2.000     1.000     
     2.000     2.000     3.000     1.000</pre>
<p>Shows the HB format for a 4 x 6 matrix :</p>
<pre>
 4 6
 0 0 0 2 1 0
 1 2 0 0 2 0
 1 4 0 0 2 3
 0 0 1 0 0 1</pre>
<p>
</p>
<hr />
<h1><a name="author">AUTHOR</a></h1>
<p>Amruta Purandare, University of Pittsburgh</p>
<p>Ted Pedersen, University of Minnesota, Duluth</p>
<p>
</p>
<hr />
<h1><a name="copyright">COPYRIGHT</a></h1>
<p>Copyright (c) 2003-2006</p>
<p>Amruta Purandare, University of Pittsburgh
<a href="mailto:amruta@cs.pitt.edu">amruta@cs.pitt.edu</a></p>
<p>Ted Pedersen, University of Minnesota, Duluth
<a href="mailto:tpederse@umn.edu">tpederse@umn.edu</a></p>
<p>This program is free software; you can redistribute it and/or modify it under
the terms of the GNU General Public License as published by the Free Software
Foundation; either version 2 of the License, or (at your option) any later
version.</p>
<p>This program is distributed in the hope that it will be useful, but WITHOUT
ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</p>
<p>You should have received a copy of the GNU General Public License along with
this program; if not, write to</p>
<p>The Free Software Foundation, Inc.,
59 Temple Place - Suite 330,
Boston, MA  02111-1307, USA.</p>

</body>

</html>
